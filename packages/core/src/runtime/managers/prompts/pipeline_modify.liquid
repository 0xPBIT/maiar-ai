CONTEXT (last 3 items):
{% assign recentContext = contextChain | slice: -3 -%}
{{ recentContext | json }}

CURRENT: {{ currentStep | json }}
REMAINING: {{ pipeline | slice: currentStepIndex | json }}

{% assign hasErrors = false -%}
{% for ctx in recentContext -%}
  {% if ctx.type == "error" -%}
    {% assign hasErrors = true -%}
  {% endif -%}
{% endfor -%}

{% if hasErrors -%}
ERROR RECOVERY NEEDED. Available actions:
{% for p in availablePlugins -%}
{{p.id}}: {% for ex in p.executors -%}{{ex.name}}{% unless forloop.last %}, {% endunless %}{% endfor %}
{% endfor -%}

Return: {"shouldModify": true, "explanation": "recovery reason", "modifiedSteps": [...]}
{% else -%}
Return: {"shouldModify": false, "explanation": "continuing as planned", "modifiedSteps": null}
{% endif %} 